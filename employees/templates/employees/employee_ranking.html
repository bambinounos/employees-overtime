{% extends 'employees/base.html' %}
{% load i18n %}

{% block title %}{% trans "Employee Ranking" %}{% endblock %}

{% block content %}
<h1>{% trans "Employee Ranking" %}</h1>
<p class="lead">{% trans "Select a KPI to see how employees stack up against each other." %}</p>

<form method="get" class="form-inline mb-4">
    <div class="form-group mr-2">
        <label for="kpi" class="mr-2">{% trans "Select KPI" %}:</label>
        <select name="kpi_id" id="kpi" class="form-control" onchange="this.form.submit()">
            <option value="">--- {% trans "Choose a KPI" %} ---</option>
            {% for kpi in all_kpis %}
                <option value="{{ kpi.id }}" {% if kpi.id == selected_kpi_id %}selected{% endif %}>
                    {{ kpi.name }}
                </option>
            {% endfor %}
        </select>
    </div>
</form>

{% if selected_kpi %}
    <h2 class="mt-4">{% trans "Ranking for" %} "{{ selected_kpi.name }}"</h2>
    <p>{% trans "Based on data from" %} {{ period }}</p>

    {% if ranking_records %}
        <table class="table table-striped table-hover">
            <thead class="thead-dark">
                <tr>
                    <th style="width: 10%;">#</th>
                    <th>{% trans "Employee" %}</th>
                    <th style="width: 20%;">{{ selected_kpi.name }} {% if selected_kpi.measurement_type == 'percentage' %}(%){% endif %}</th>
                </tr>
            </thead>
            <tbody>
                {% for record in ranking_records %}
                <tr {% if forloop.first %}class="table-success"{% endif %}>
                    <td class="font-weight-bold">
                        {% if forloop.first %}
                            ðŸ¥‡ 1
                        {% elif forloop.counter == 2 %}
                            ðŸ¥ˆ 2
                        {% elif forloop.counter == 3 %}
                            ðŸ¥‰ 3
                        {% else %}
                            {{ forloop.counter }}
                        {% endif %}
                    </td>
                    <td>{{ record.employee.name }}</td>
                    <td>{{ record.actual_value|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <div class="alert alert-info mt-4" role="alert">
            {% trans "No performance data found for this KPI in the most recent period." %}
        </div>
    {% endif %}
{% elif selected_kpi_id %}
    <div class="alert alert-warning mt-4" role="alert">
        {% trans "Please select a valid KPI." %}
    </div>
{% endif %}

{% endblock %}
